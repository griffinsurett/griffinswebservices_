---
// src/components/Logo/TextLogoStatic.astro
// CSS-only scroll-driven text fade animation
// Zero JavaScript required - uses modern CSS scroll timeline API

interface Props {
  title?: string;
  className?: string;
  firstClass?: string;
  restClass?: string;
  fadeDuration?: number;
  animateOutText?: boolean;
}

const {
  title = "",
  className = "",
  firstClass = "text-3xl text-heading -ml-[0.1rem] leading-wide font-bold no-translate",
  restClass = "font-light emphasized-text uppercase text-xs lg:text-sm p-0 m-0 tracking-[0.2em]",
  fadeDuration = 1200,
  animateOutText = false,
} = Astro.props;

const words = title.split(" ");
const firstWord = words[0] || "";
const restOfTitle = words.slice(1).join(" ");
---

<div
  class={className}
  data-scroll-fade-css={animateOutText ? "true" : undefined}
>
  <span class={firstClass} style="line-height: normal;">
    {firstWord}
  </span>
  {restOfTitle && (
    <span class={restClass} style="line-height: normal;">
      {" "}{restOfTitle}
    </span>
  )}
</div>

<style>
  /* CSS-only scroll-driven fade animation - Zero JavaScript */
  @supports (animation-timeline: scroll()) {
    [data-scroll-fade-css] {
      animation: text-fade-out linear forwards;
      animation-timeline: scroll(root);
      animation-range: 0px 50px;
    }

    @keyframes text-fade-out {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-1rem);
      }
    }
  }

  /* Fallback for older browsers - uses JavaScript scroll observer */
  @supports not (animation-timeline: scroll()) {
    [data-scroll-fade-css] {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 300ms ease, transform 300ms ease;
    }

    [data-scroll-fade-css][data-scrolled="true"] {
      opacity: 0;
      transform: translateY(-1rem);
    }
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    [data-scroll-fade-css] {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
  }
</style>

<script>
  // JavaScript fallback for browsers without animation-timeline support
  // Only runs on older browsers (Safari < 17.5, Firefox, older Chrome)
  (function initScrollFadeFallback() {
    if (typeof window === "undefined") return;

    // Feature detection - only run if animation-timeline is NOT supported
    if (CSS.supports && CSS.supports('animation-timeline: scroll()')) {
      return; // Modern browser - CSS handles everything
    }

    const element = document.querySelector('[data-scroll-fade-css]');
    if (!element) return;

    let ticking = false;
    const threshold = 50; // Same as CSS animation-range: 0px 50px

    const updateFade = () => {
      const scrolled = window.scrollY > threshold;
      if (scrolled) {
        element.setAttribute('data-scrolled', 'true');
      } else {
        element.removeAttribute('data-scrolled');
      }
      ticking = false;
    };

    const onScroll = () => {
      if (!ticking) {
        requestAnimationFrame(updateFade);
        ticking = true;
      }
    };

    // Initial check
    updateFade();

    // Listen for scroll
    window.addEventListener('scroll', onScroll, { passive: true });
  })();
</script>
