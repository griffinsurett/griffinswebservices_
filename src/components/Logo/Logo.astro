---
import LottieLogo from "./LottieLogo";
import TextLogo from "./TextLogo";
import { Image } from "astro:assets";
import POSTER_SRC from "@/assets/GWS-animated.png";
import { siteData } from "@/content/siteData";

export interface Props {
  loading?: "lazy" | "eager";
  trigger?: "auto" | "scroll" | "visible" | "load";
  textFadeMs?: number;
  animateOutText?: boolean;
  class?: string;
  useLottie?: boolean;
  scale?: number;
}

const {
  loading = "eager",
  trigger = "auto",
  textFadeMs = 1200,
  animateOutText = false,
  class: className = "",
  useLottie = true,
  scale = 1,
} = Astro.props;

const shouldUseLottie =
  useLottie &&
  (trigger === "scroll" ||
    trigger === "visible" ||
    trigger === "load");

// Base sizes scaled by the scale prop
const baseSize = 45;
const scaledSize = Math.round(baseSize * scale);
const baseMobileSize = 43;
const scaledMobileSize = Math.round(baseMobileSize * scale);

const LOGO_WIDTHS = [scaledMobileSize, Math.round(80 * scale), scaledSize];
const LOGO_SIZES = `(min-width: 1024px) ${scaledSize}px, ${scaledMobileSize}px`;

// Logo class with dynamic sizing via CSS custom properties
const logoClasses = "block object-contain logo-scaled";

// Text size classes based on scale
const textClasses = scale >= 1.5
  ? {
      firstClass: "text-4xl lg:text-5xl -ml-[0.1rem] leading-wide font-bold",
      restClass: "font-light text-accent uppercase text-sm lg:text-base p-0 m-0 tracking-wider",
    }
  : {
      firstClass: "text-3xl -ml-[0.1rem] leading-wide font-bold",
      restClass: "font-light text-accent uppercase text-xs lg:text-sm p-0 m-0 tracking-wider",
    };
---

<a href="/" class={`flex justify-center items-center gap-1.5 ${className}`}>
  {shouldUseLottie ? (
    <>
      {trigger === "scroll" ? (
        <LottieLogo
          alt="Griffin's Web Services Animated Logo"
          loading={loading}
          trigger={trigger}
          className="logo-class"
          mediaClasses={logoClasses}
          client:idle
        >
          <Image
            src={POSTER_SRC}
            alt="Griffin's Web Services Logo"
            loading={loading}
            decoding="async"
            format="webp"
            widths={LOGO_WIDTHS}
            sizes={LOGO_SIZES}
            quality={90}
            class={logoClasses}
            fetchpriority={loading === "eager" ? "high" : "low"}
          />
        </LottieLogo>
      ) : trigger === "visible" ? (
        <LottieLogo
          alt="Griffin's Web Services Animated Logo"
          loading={loading}
          trigger={trigger}
          className="logo-class"
          mediaClasses={logoClasses}
          client:visible
        >
          <Image
            src={POSTER_SRC}
            alt="Griffin's Web Services Logo"
            loading={loading}
            decoding="async"
            format="webp"
            widths={LOGO_WIDTHS}
            sizes={LOGO_SIZES}
            quality={90}
            class={logoClasses}
            fetchpriority={loading === "eager" ? "high" : undefined}
          />
        </LottieLogo>
      ) : (
        <LottieLogo
          alt="Griffin's Web Services Animated Logo"
          loading={loading}
          trigger={trigger}
          className="logo-class"
          mediaClasses={logoClasses}
          client:load
        >
          <Image
            src={POSTER_SRC}
            alt="Griffin's Web Services Logo"
            loading={loading}
            decoding="async"
            format="webp"
            widths={LOGO_WIDTHS}
            sizes={LOGO_SIZES}
            quality={90}
            class={logoClasses}
            fetchpriority={loading === "eager" ? "high" : undefined}
          />
        </LottieLogo>
      )}
    </>
  ) : (
    <Image
      src={POSTER_SRC}
      alt="Griffin's Web Services Logo"
      loading={loading}
      decoding="async"
      format="webp"
      widths={LOGO_WIDTHS}
      sizes={LOGO_SIZES}
      quality={90}
      class={logoClasses}
      fetchpriority={loading === "eager" ? "high" : undefined}
    />
  )}

  <div>
    <TextLogo
      title={siteData.title}
      className="flex flex-col p-0 m-0"
      firstClass={textClasses.firstClass}
      restClass={textClasses.restClass}
      fadeDuration={textFadeMs}
      animateOutText={animateOutText}
      client:load={loading === "eager"}
      client:visible={loading !== "eager"}
    />
  </div>
</a>

<style define:vars={{ scaledMobileSize: `${scaledMobileSize}px`, scaledSize: `${scaledSize}px` }}>
  .logo-scaled {
    width: var(--scaledMobileSize);
    height: var(--scaledMobileSize);
  }
  @media (min-width: 1024px) {
    .logo-scaled {
      width: var(--scaledSize);
      height: var(--scaledSize);
    }
  }
</style>
