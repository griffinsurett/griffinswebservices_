---
// src/layouts/SolutionsSection.astro
/**
 * Reusable section for solution pages
 * Renders ContentSection, benefits, testimonials, and CTA
 *
 * Similar to CapabilitiesSection - this is rendered in the MDX body
 * with all content-specific props passed in.
 */
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import ContentSection from "@/layouts/ContentSection.astro";
import CTASection from "@/layouts/CTASection.astro";
import { query, sortByOrder, related } from "@/utils/query";

interface Feature {
  title: string;
  description?: string;
}

interface Benefit {
  title: string;
  description?: string;
  icon?: string;
}

interface QuickFact {
  title: string;
  description: string;
}

interface HeadingContent {
  title?: string;
  before?: string;
  text?: string;
  after?: string;
  description?: string;
}

interface CTAButton {
  text: string;
  href?: string;
  link?: string;
  rightIcon?: string;
}

interface SidebarContent {
  icon?: string;
  title?: string;
  eyebrow?: string;
  description?: string;
  footIcon?: string;
  footTitle?: string;
  footDescription?: string;
  features?: Feature[];
}

interface Props {
  /** Solution title for dynamic headings */
  title: string;
  /** Solution slug for querying related FAQs */
  slug: string;
  /** Solution icon */
  icon?: string;
  /** Features list (displayed in sidebar) */
  features?: Feature[];
  /** Quick facts */
  quickFacts?: QuickFact[];
  /** Content section heading */
  contentHeading: HeadingContent;
  /** Primary CTA button for content section */
  primaryCTA?: CTAButton;
  /** Secondary CTA button for content section */
  secondaryCTA?: CTAButton;
  /** Sidebar content */
  sidebar: SidebarContent;
  /** Text content paragraphs */
  textContent: string[];
  /** Benefits section title */
  benefitsTitle?: string;
  /** Benefits section heading */
  benefitsHeading?: string;
  /** FAQ section title */
  faqTitle?: string;
  /** FAQ section heading */
  faqHeading?: string;
  /** CTA section title */
  ctaTitle?: string;
  /** CTA section heading */
  ctaHeading?: string | HeadingContent;
  /** CTA section description */
  ctaDescription?: string;
  /** CTA primary button */
  ctaPrimaryButton?: CTAButton;
  /** CTA section ID */
  ctaId?: string;
}

const {
  title,
  slug,
  icon,
  features = [],
  quickFacts = [],
  contentHeading,
  primaryCTA = {
    text: "Get Your Free Quote",
    href: "#solutions-quote-hero",
    rightIcon: "lu:arrow-right"
  },
  secondaryCTA = {
    text: "See our work",
    href: "#solutions-projects"
  },
  sidebar,
  textContent = [],
  benefitsTitle = "Why Choose Us",
  benefitsHeading,
  faqTitle = "FAQs",
  faqHeading,
  ctaTitle,
  ctaHeading,
  ctaDescription,
  ctaPrimaryButton,
  ctaId = "solutions-cta",
} = Astro.props;

// Build the full sidebar with features included
const fullSidebar = sidebar ? {
  ...sidebar,
  icon: sidebar.icon || icon,
  features
} : undefined;
---

<ContentSection
  heading={contentHeading}
  primaryCTA={primaryCTA}
  secondaryCTA={secondaryCTA}
  sidebar={fullSidebar}
>
  <div slot="text" class="space-y-6 text-lg text-muted">
    {textContent.map((paragraph) => (
      <p>{paragraph}</p>
    ))}
  </div>

  {quickFacts.length > 0 && (
    <ContentRenderer
      slot="quick-facts"
      items={quickFacts}
      variant="QuickFactsVariant"
      columns={1}
    />
  )}
</ContentSection>

<ContentRenderer
  query={query("benefits").orderBy(sortByOrder())}
  variant="BenefitsVariant"
  columns={2}
  gap="lg"
  title={benefitsTitle}
  heading={benefitsHeading || `What Makes Our ${title} Different`}
/>

<ContentRenderer
  query={query("testimonials")}
  variant="TestimonialCarouselVariant"
/>

<ContentRenderer
  query={related("faq", "solutions", slug)}
  variant="AccordionVariant"
  allowMultiple={false}
  title={faqTitle}
  heading={faqHeading || `Common Questions About ${title}`}
/>

{ctaHeading && (
  <CTASection
    id={ctaId}
    className="min-h-[60vh]"
    title={ctaTitle}
    heading={ctaHeading}
    description={ctaDescription}
    primaryCTA={ctaPrimaryButton || {
      text: "Get Your Free Quote",
      link: "#solutions-quote-hero",
    }}
  />
)}
