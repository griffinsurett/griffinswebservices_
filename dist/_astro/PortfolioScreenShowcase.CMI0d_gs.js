import{r as s,j as l}from"./react-core.QUkC7_l_.js";import{u as Y}from"./useEngagementAutoScroll.8K-EtYKb.js";import{g as I}from"./layoutHelpers.DmHfmlAk.js";import"./useVisibility.B-3m_lqm.js";import"./IntersectionObserver.CmZxnn85.js";const $=700,B=14,j=B*1e3,q=28,G=4,V=220,X=16,J=2200,K=450,Q=750;function Z(){const[o,n]=s.useState(!1);return s.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia>"u")return;const u=window.matchMedia("(min-width: 1024px)"),d=v=>{n(v.matches)};return d(u),typeof u.addEventListener=="function"?(u.addEventListener("change",d),()=>u.removeEventListener("change",d)):(u.addListener(d),()=>u.removeListener(d))},[]),o}function ee({item:o,mediaEntry:n,totalSlides:u,activeIndex:d,onCycleComplete:v,autoplayEnabled:i=!0,isActive:C,shouldUseDesktopEager:p,onImageLoad:b,deferImageRender:N=!1}){const h=s.useRef(null),[f,w]=s.useState(!1),g=s.useRef(!1),[c,_]=s.useState(!1),[y,A]=s.useState(j);s.useRef(0);const R=s.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return 0;const r=t/B;return!Number.isFinite(r)||r<=0?q:Math.max(q,r)},[]),E=s.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return j;const r=R(e);if(r<=0)return j;const m=Math.round(t/r*1e3);return!Number.isFinite(m)||m<=0?j:Math.max(j,m)},[R]),x=Y({ref:h,active:i&&c,speed:R,loop:!1,startDelay:$,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});s.useEffect(()=>{i&&(x.resetPosition(0),h.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[i,x.resetPosition]),s.useEffect(()=>{const e=h.current;if(!e)return;const t=e.querySelector("picture img")??e.querySelector("img");if(!t){w(!0);return}if(t.complete&&t.naturalHeight>0){w(!0);return}w(!1);const r=()=>w(!0);return t.addEventListener("load",r,{once:!0}),t.addEventListener("error",r,{once:!0}),()=>{t.removeEventListener("load",r),t.removeEventListener("error",r)}},[o,n]),s.useEffect(()=>{f&&b&&!g.current&&(g.current=!0,b())},[f,b]),s.useEffect(()=>{if(!f){_(!1);return}const e=h.current;if(!e)return;let t=!1,r=null;const m=()=>Math.max(0,e.scrollHeight-e.clientHeight)>G,L=()=>{t||(t=!0,r?.(),r=null,_(!0))},k=()=>{if(typeof ResizeObserver>"u"){L();return}let a=null,z=e.scrollHeight;const F=()=>{a||(a=window.setTimeout(()=>{a=null,L()},V))},W=()=>{a&&(window.clearTimeout(a),a=null)},H=new ResizeObserver(()=>{const U=e.scrollHeight;Math.abs(U-z)>X&&(z=U,W()),F()});H.observe(e),F(),r=()=>{H.disconnect(),a&&(window.clearTimeout(a),a=null)}};if(m())k();else if(typeof ResizeObserver<"u"){const a=new ResizeObserver(()=>{m()&&(a.disconnect(),k())});a.observe(e),r=()=>a.disconnect()}else L();const T=window.setTimeout(()=>{L()},J);return()=>{r?.(),window.clearTimeout(T)}},[f]),s.useEffect(()=>{if(!c||!i){A(j);return}const e=h.current;if(!e)return;const t=()=>A(E(e));t();const r=typeof ResizeObserver<"u"?new ResizeObserver(()=>t()):null;return r?.observe(e),()=>r?.disconnect()},[c,E]),s.useEffect(()=>{if(!c||!i||u<=1||x.paused)return;const e=$+y+K,t=window.setTimeout(()=>v(),e);return()=>window.clearTimeout(t)},[i,c,v,y,u,x.paused]),s.useEffect(()=>{},[c,C]);const M=I(o.featuredImage)||I(o.bannerImage)||I(o.image)||"",S=!!(n?.desktopEager&&p),O=S?"eager":n?.loading??"lazy",D=S?"high":n?.fetchPriority??"auto",P=()=>N?l.jsx("div",{className:"flex h-full w-full items-center justify-center bg-black/40"}):n?.sources?.length?l.jsxs("picture",{children:[n.sources.map((e,t)=>l.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??n.sizes,type:e.type},`${o.slug??o.id??t}-source-${t}`)),l.jsx("img",{src:n.src,srcSet:n.srcSet,sizes:n.sizes,alt:n.alt||o.alt||o.title||"Project preview",width:n.width,height:n.height,loading:O,decoding:n.decoding??"async",fetchPriority:D,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):n?.src?l.jsx("img",{src:n.src,srcSet:n.srcSet,sizes:n.sizes,alt:n.alt||o.alt||o.title||"Project preview",width:n.width,height:n.height,loading:O,decoding:n.decoding??"async",fetchPriority:D,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):M?l.jsx("img",{src:M,alt:o.alt||o.title||"Project preview",loading:S?"eager":"lazy",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async",fetchPriority:S?"high":"auto"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return l.jsx("div",{className:"relative h-full w-full",children:l.jsxs("div",{className:"relative h-full bg-bg3",children:[l.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:l.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:l.jsxs("span",{className:"flex items-center gap-1.5",children:[l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),l.jsx("figure",{ref:h,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:P()}),!1]})})}function oe({items:o=[],className:n="",mediaEntries:u=[],staticContainerId:d,carouselContainerId:v}){const i=s.useMemo(()=>Array.isArray(o)?o:[],[o]),C=s.useMemo(()=>Array.isArray(u)?u:[],[u]),[p,b]=s.useState(0),[N,h]=s.useState(null),[f,w]=s.useState("idle"),g=s.useRef(null),c=s.useRef(null),_=Z(),[y,A]=s.useState(!1),R=s.useRef(!1),[E,x]=s.useState(!1);s.useEffect(()=>{if(d){const e=window.setTimeout(()=>{x(!0)},100);return()=>window.clearTimeout(e)}else x(!0)},[d]);const M=s.useCallback(()=>{if(R.current)return;R.current=!0;const e=d?document.getElementById(d):null,t=v?document.getElementById(v):null;requestAnimationFrame(()=>{requestAnimationFrame(()=>{t&&t.classList.remove("opacity-0","pointer-events-none"),e&&(e.style.visibility="hidden"),A(!0)})})},[d,v]);s.useEffect(()=>{if(!i.length){b(0),h(null),w("idle");return}b(e=>e>=i.length?0:e)},[i.length]),s.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=null),c.current&&(cancelAnimationFrame(c.current),c.current=null)},[]);const S=s.useCallback(e=>{typeof window>"u"||(h(p),b(e),w("pre"),c.current&&(cancelAnimationFrame(c.current),c.current=null),c.current=requestAnimationFrame(()=>{c.current=requestAnimationFrame(()=>{w("animating")})}),g.current&&(window.clearTimeout(g.current),g.current=null),g.current=window.setTimeout(()=>{w("idle"),h(null)},Q))},[p]),O=s.useCallback(()=>{if(!i.length||i.length<=1||f!=="idle")return;const e=(p+1)%i.length;S(e)},[p,i.length,S,f]);if(!i.length)return null;const D="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return l.jsx("div",{className:`relative ${n}`.trim(),children:l.jsx("div",{className:"relative mx-auto w-full max-w-4xl overflow-hidden rounded-lg h-[420px] sm:h-[500px]",children:i.map((e,t)=>{const r=t===p,m=t===N,L=r||m&&f!=="idle";if(!(r||m&&f!=="idle"))return null;let T="translate-x-full";return m&&f!=="idle"?T="-translate-x-full":r&&(f==="idle"||N===null?T="translate-x-0":f==="pre"?T="translate-x-full":T="translate-x-0"),l.jsx("div",{className:`${D} shadow-2xl ${T} ${L?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":r?"false":"true",children:l.jsx(ee,{item:e,mediaEntry:C[t],totalSlides:i.length||1,activeIndex:t,onCycleComplete:O,autoplayEnabled:r&&f==="idle"&&y,isActive:r,shouldUseDesktopEager:_,onImageLoad:t===0?M:void 0,deferImageRender:t===0&&!E})},e.slug??e.id??t)})})})}export{oe as default};
