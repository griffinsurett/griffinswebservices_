import{r as n,j as l}from"./react-core.BKcrIQ47.js";import{u as k}from"./useEngagementAutoScroll.Dewbw4xG.js";import{g as O}from"./layoutHelpers.DmHfmlAk.js";import"./useVisibility.Dfexy_Di.js";const z=700,E=14,T=E*1e3,P=28,U=4,F=220,$=16,q=2200,W=450,B=750;function Y({item:o,mediaEntry:s,totalSlides:m,activeIndex:c,onCycleComplete:_,autoplayEnabled:a=!0,isActive:j}){const b=n.useRef(null),[R,w]=n.useState(!1),[d,f]=n.useState(!1),[x,h]=n.useState(T);n.useRef(0);const u=n.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return 0;const r=t/E;return!Number.isFinite(r)||r<=0?P:Math.max(P,r)},[]),N=n.useCallback(e=>{const t=Math.max(0,e.scrollHeight-e.clientHeight);if(t<=0)return T;const r=u(e);if(r<=0)return T;const g=Math.round(t/r*1e3);return!Number.isFinite(g)||g<=0?T:Math.max(T,g)},[u]),S=k({ref:b,active:a&&d,speed:u,loop:!1,startDelay:z,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});n.useEffect(()=>{a&&(S.resetPosition(0),b.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[a,S.resetPosition]),n.useEffect(()=>{const e=b.current;if(!e)return;const t=e.querySelector("picture img")??e.querySelector("img");if(!t){w(!0);return}if(t.complete&&t.naturalHeight>0){w(!0);return}w(!1);const r=()=>w(!0);return t.addEventListener("load",r,{once:!0}),t.addEventListener("error",r,{once:!0}),()=>{t.removeEventListener("load",r),t.removeEventListener("error",r)}},[o,s]),n.useEffect(()=>{if(!R){f(!1);return}const e=b.current;if(!e)return;let t=!1,r=null;const g=()=>Math.max(0,e.scrollHeight-e.clientHeight)>U,p=()=>{t||(t=!0,r?.(),r=null,f(!0))},C=()=>{if(typeof ResizeObserver>"u"){p();return}let i=null,L=e.scrollHeight;const y=()=>{i||(i=window.setTimeout(()=>{i=null,p()},F))},H=()=>{i&&(window.clearTimeout(i),i=null)},D=new ResizeObserver(()=>{const I=e.scrollHeight;Math.abs(I-L)>$&&(L=I,H()),y()});D.observe(e),y(),r=()=>{D.disconnect(),i&&(window.clearTimeout(i),i=null)}};if(g())C();else if(typeof ResizeObserver<"u"){const i=new ResizeObserver(()=>{g()&&(i.disconnect(),C())});i.observe(e),r=()=>i.disconnect()}else p();const v=window.setTimeout(()=>{p()},q);return()=>{r?.(),window.clearTimeout(v)}},[R]),n.useEffect(()=>{if(!d||!a){h(T);return}const e=b.current;if(!e)return;const t=()=>h(N(e));t();const r=typeof ResizeObserver<"u"?new ResizeObserver(()=>t()):null;return r?.observe(e),()=>r?.disconnect()},[d,N]),n.useEffect(()=>{if(!d||!a||m<=1||S.paused)return;const e=z+x+W,t=window.setTimeout(()=>_(),e);return()=>window.clearTimeout(t)},[a,d,_,x,m,S.paused]),n.useEffect(()=>{},[d,j]);const A=O(o.featuredImage)||O(o.bannerImage)||O(o.image)||"",M=()=>s?.sources?.length?l.jsxs("picture",{children:[s.sources.map((e,t)=>l.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??s.sizes,type:e.type},`${o.slug??o.id??t}-source-${t}`)),l.jsx("img",{src:s.src,srcSet:s.srcSet,sizes:s.sizes,alt:s.alt||o.alt||o.title||"Project preview",width:s.width,height:s.height,loading:s.loading??"lazy",decoding:s.decoding??"async",fetchPriority:s.fetchPriority,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):s?.src?l.jsx("img",{src:s.src,srcSet:s.srcSet,sizes:s.sizes,alt:s.alt||o.alt||o.title||"Project preview",width:s.width,height:s.height,loading:s.loading??"lazy",decoding:s.decoding??"async",fetchPriority:s.fetchPriority,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):A?l.jsx("img",{src:A,alt:o.alt||o.title||"Project preview",loading:"eager",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return o.client||o.title,`${String(c+1).padStart(2,"0")}${String(m).padStart(2,"0")}`,l.jsx("div",{className:"relative h-full w-full",children:l.jsxs("div",{className:"relative h-full bg-bg3",children:[l.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:l.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:l.jsxs("span",{className:"flex items-center gap-1.5",children:[l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),l.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),l.jsx("figure",{ref:b,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:M()}),!1]})})}function K({items:o=[],className:s="",mediaEntries:m=[]}){const c=n.useMemo(()=>Array.isArray(o)?o:[],[o]),_=n.useMemo(()=>Array.isArray(m)?m:[],[m]),[a,j]=n.useState(0),[b,R]=n.useState(0),[w,d]=n.useState(null),[f,x]=n.useState("idle"),h=n.useRef(null),u=n.useRef(null);n.useEffect(()=>{if(!c.length){j(0),R(0),d(null),x("idle");return}j(e=>e>=c.length?0:e)},[c.length]),n.useEffect(()=>()=>{h.current&&(window.clearTimeout(h.current),h.current=null),u.current&&(cancelAnimationFrame(u.current),u.current=null)},[]);const N=n.useCallback(e=>{typeof window>"u"||(d(a),j(e),x("pre"),u.current&&(cancelAnimationFrame(u.current),u.current=null),u.current=requestAnimationFrame(()=>{u.current=requestAnimationFrame(()=>{x("animating")})}),h.current&&(window.clearTimeout(h.current),h.current=null),h.current=window.setTimeout(()=>{x("idle"),d(null),R(t=>t+1)},B))},[a]),S=n.useCallback(()=>{if(!c.length||c.length<=1||f!=="idle")return;const e=(a+1)%c.length;N(e)},[a,c.length,N,f]);if(!c.length)return null;c[a];const A="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return l.jsx("div",{className:`relative ${s}`.trim(),children:l.jsx("div",{className:"relative mx-auto w-full max-w-4xl overflow-hidden rounded-lg h-[420px] sm:h-[500px]",children:c.map((e,t)=>{const r=t===a,g=t===w,p=r||g&&f!=="idle";if(!(r||g&&f!=="idle"))return null;let v="translate-x-full";return g&&f!=="idle"?v="-translate-x-full":r&&(f==="idle"||w===null?v="translate-x-0":f==="pre"?v="translate-x-full":v="translate-x-0"),l.jsx("div",{className:`${A} shadow-2xl ${v} ${p?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":r?"false":"true",children:l.jsx(Y,{item:e,mediaEntry:_[t],totalSlides:c.length||1,activeIndex:t,onCycleComplete:S,autoplayEnabled:r&&f==="idle",isActive:r})},e.slug??e.id??t)})})})}export{K as default};
