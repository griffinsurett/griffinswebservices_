import{r as e}from"./react-core.BKcrIQ47.js";import{u as q,c as V,a as _,d as U}from"./useVisibility.Dfexy_Di.js";function W({ref:n,active:m=!1,speed:b=40,cycleDuration:p=0,loop:A=!1,startDelay:H=1500,resetOnInactive:x=!0}){const h=e.useRef(null),M=e.useRef(0),C=e.useRef(null),s=e.useRef(0),g=e.useRef(!1),u=e.useRef(!1),d=e.useRef(null),[E,y]=e.useState(0),v=e.useCallback(t=>{if(p&&p>0){const r=Math.max(0,t.scrollHeight-t.clientHeight);return r>0?r/p:0}return typeof b=="function"?Math.max(1,b(t)):Number(b)||0},[p,b]),o=e.useCallback(()=>{h.current&&cancelAnimationFrame(h.current),h.current=null,M.current=0},[]),f=e.useCallback(()=>{C.current&&(clearTimeout(C.current),C.current=null)},[]),S=e.useCallback(()=>{u.current=!0,d.current&&(cancelAnimationFrame(d.current),d.current=null),d.current=requestAnimationFrame(()=>{u.current=!1,d.current=null})},[]),c=e.useCallback(t=>{if(!m)return;const r=n.current;if(!r)return;const i=M.current||t,R=Math.min(.05,Math.max(0,(t-i)/1e3));M.current=t;const l=Math.max(0,r.scrollHeight-r.clientHeight);if(l<=0){h.current=requestAnimationFrame(c);return}s.current===0&&r.scrollTop>0&&(s.current=r.scrollTop);const F=v(r)*R;if(s.current=Math.min(l,s.current+F),S(),r.scrollTo({top:s.current,left:0,behavior:"auto"}),s.current>=l-.5)if(A)s.current=0,r.scrollTo({top:0,left:0,behavior:"auto"});else{o();return}h.current=requestAnimationFrame(c)},[m,o,A,S,n,v]),a=e.useCallback(()=>{o();const t=n.current;t&&(s.current=t.scrollTop||0,g.current=!0,h.current=requestAnimationFrame(c))},[o,n,c]),P=e.useCallback(()=>{o()},[o]),L=e.useCallback((t=0)=>{const r=n.current;r&&(s.current=t,r.scrollTo({top:t,left:0,behavior:"auto"}))},[n]);return e.useEffect(()=>(o(),f(),m&&(g.current?a():C.current=setTimeout(()=>{m&&a()},Math.max(0,H))),()=>{o(),f()}),[m,H,a,o,f,E]),e.useEffect(()=>{x&&(m||(g.current=!1,o(),f(),u.current=!1,s.current=0,n.current?.scrollTo({top:0,left:0,behavior:"auto"})))},[m,o,f,n,x]),e.useEffect(()=>{const t=n.current;if(!t||typeof ResizeObserver>"u")return;let r=Math.max(0,t.scrollHeight-t.clientHeight);const i=new ResizeObserver(()=>{const R=Math.max(0,t.scrollHeight-t.clientHeight);R>r+1&&(r=R,y(l=>l+1))});return i.observe(t),()=>i.disconnect()},[n]),e.useEffect(()=>()=>{o(),f(),d.current&&(cancelAnimationFrame(d.current),d.current=null),u.current=!1},[o,f]),{startNow:a,stopNow:P,resetPosition:L,isAnimating:()=>!!h.current,hasStartedThisCycle:()=>g.current,getCurrentPosition:()=>s.current,internalScrollRef:u,getMetrics:()=>{const t=n.current,r=t?Math.max(0,t.scrollHeight-t.clientHeight):0,i=t?t.scrollTop:0,R=r>0?i/r:0;return{top:i,max:r,progress:R,animating:!!h.current,started:g.current,internalGuard:u.current}}}}function G({ref:n,active:m=!1,speed:b=40,cycleDuration:p=0,loop:A=!1,startDelay:H=1500,resumeDelay:x=900,resumeOnUserInput:h=!0,threshold:M=.3,visibleRootMargin:C="0px",resetOnInactive:s=!0}){const g=e.useRef(null),u=e.useRef(!1),[d,E]=e.useState(!1),[y,v]=e.useState(!1),[o,f]=e.useState(!1),S=q(n,{threshold:M,rootMargin:C}),c=W({ref:n,active:m&&S&&!d,speed:b,cycleDuration:p,loop:A,startDelay:H,resetOnInactive:s}),a=e.useCallback(()=>{g.current&&(clearTimeout(g.current),g.current=null),v(!1)},[]),P=e.useCallback(()=>{E(!0),a()},[a]),L=e.useCallback(()=>{h&&(u.current||(a(),v(!0),g.current=setTimeout(()=>{u.current||(v(!1),E(!1))},Math.max(0,x))))},[h,x,a]),t=e.useCallback(l=>{const T=n.current;T&&T.dispatchEvent(new CustomEvent("autoscroll-user",{bubbles:!0,detail:{phase:l}}))},[n]),r=e.useCallback(()=>{u.current=!0,f(!0),P(),t("start")},[P,t]),i=e.useCallback(()=>{u.current=!1,f(!1),t("end"),L()},[t,L]),R=e.useCallback(()=>{u.current=!0,f(!0)},[]);return V({elementRef:n,tapThreshold:8,longPressDelay:600,onTouchStart:r,onTouchMove:(l,T)=>{T.moved&&r()},onTouchEnd:i,onLongPress:r,preventDefaultOnTouch:!1}),_({elementRef:n,scrollThreshold:1,debounceDelay:80,trustedOnly:!0,internalFlagRef:c.internalScrollRef,wheelSensitivity:1,onScrollStart:r,onScrollActivity:R,onWheelActivity:r,onScrollEnd:i}),U({elementRef:n,onPointerDown:r,onPointerMove:(l,T)=>{T.moved&&r()},onPointerUp:i}),e.useEffect(()=>{const l=n.current;if(!l)return;const T=160,F=160;let k=null,w=null;const N=()=>{c.internalScrollRef.current||(r(),k&&clearTimeout(k),k=setTimeout(i,T))},I=()=>{r(),w&&clearTimeout(w),w=setTimeout(i,F)};return l.addEventListener("scroll",N,{passive:!0}),l.addEventListener("wheel",I,{passive:!0}),()=>{l.removeEventListener("scroll",N),l.removeEventListener("wheel",I),k&&clearTimeout(k),w&&clearTimeout(w)}},[c.internalScrollRef,i,r,n]),e.useEffect(()=>{s&&(!m||!S)&&(u.current=!1,f(!1),E(!1),a())},[m,S,s,a]),e.useEffect(()=>()=>{a(),u.current=!1,f(!1)},[a]),{inView:S,paused:d,resumeScheduled:y,engaged:o,pauseNow:P,resumeNow:()=>{a(),E(!1)},startNow:c.startNow,stopNow:c.stopNow,resetPosition:c.resetPosition,isAnimating:c.isAnimating,hasStartedThisCycle:c.hasStartedThisCycle,getCurrentPosition:c.getCurrentPosition,getMetrics:c.getMetrics}}export{G as u};
