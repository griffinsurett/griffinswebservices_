---
// src/components/Form/forms/ContactForm.astro
/**
 * Contact Form - Astro Version
 * Pure HTML with optional React enhancement via client:idle
 */
import FormWrapper from "@/components/Form/FormWrapper";
import Input from "@/components/Form/inputs/Input";
import Textarea from "@/components/Form/inputs/Textarea";
import { submitToFormspree } from "@/utils/formspree";

interface Props {
  title?: string;
  description?: string;
  className?: string;
}

const { title, description, className = "" } = Astro.props;
const FORMSPREE_BASE_ACTION = "https://formspree.io/f/";
const contactFormId = import.meta.env.PUBLIC_FORMSPREE_CONTACT_ID;
const contactFormAction = contactFormId
  ? `${FORMSPREE_BASE_ACTION}${contactFormId}`
  : undefined;

const handleSubmit = async (values: Record<string, unknown>) => {
  if (!contactFormAction) {
    throw new Error("Contact form is temporarily unavailable. Please try again later.");
  }

  await submitToFormspree({
    endpoint: contactFormAction,
    values,
    formName: "Contact Form",
    excludeKeys: ["terms-agreement"],
  });
};
---

<div class={className}>
  {title && <h2 class="text-3xl font-bold mb-3">{title}</h2>}
  {description && <p class="text-text mb-8">{description}</p>}

  <FormWrapper
    client:idle
    onSubmit={handleSubmit}
    formAction={contactFormAction}
    formMethod="post"
    className="group section-box card-bg outer-card-transition flex flex-col relative overflow-hidden"
    submitButton={{
      text: "Submit Form",
      className: "w-full md:w-auto",
      disabled: !contactFormAction
    }}
  >
    <div class="inner-card-style inner-card-transition inner-card-color" aria-hidden="true"></div>

    <div class="relative z-10 grid gap-4 md:grid-cols-2">
      <Input
        client:idle
        name="firstName"
        label="First Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="Full Name *"
        containerClassName="md:col-span-1"
        showLabel={false}
      />

      <Input
        client:idle
        name="lastName"
        label="Last Name"
        type="text"
        required={true}
        minLength={2}
        placeholder="Last Name *"
        containerClassName="md:col-span-1"
        showLabel={false}
      />

      <Input
        client:idle
        name="email"
        label="Email"
        type="email"
        required={true}
        placeholder="Email Address *"
        containerClassName="md:col-span-1"
        showLabel={false}
      />

      <Input
        client:idle
        name="phone"
        label="Phone Number"
        type="tel"
        required={true}
        pattern="[0-9]{10,}"
        title="Please enter at least 10 digits"
        placeholder="Phone Number *"
        containerClassName="md:col-span-1"
        showLabel={false}
      />

      <Input
        client:idle
        name="company"
        label="Company Name"
        type="text"
        placeholder="Company Name"
        containerClassName="md:col-span-2"
        showLabel={false}
      />

      <Textarea
        client:idle
        name="message"
        label="Your Message"
        required={true}
        minLength={10}
        placeholder="Tell us about your project, goals, and any specific requirements..."
        rows={5}
        containerClassName="md:col-span-2"
        showLabel={false}
      />
    </div>
  </FormWrapper>
</div>
