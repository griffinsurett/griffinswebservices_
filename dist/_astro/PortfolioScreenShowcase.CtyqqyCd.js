import{r as t,j as o}from"./react-core.Dcp9QKwj.js";import{u as Y}from"./useEngagementAutoScroll.BV7eLq0q.js";import{g as C}from"./Counter.rbBGYAKt.js";import"./useVisibility.Bq4X3Whu.js";const U=700,B=14,E=B*1e3,q=28,G=4,V=220,X=16,J=2200,K=450,Q=750;function Z(){const[i,s]=t.useState(!1);return t.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia>"u")return;const d=window.matchMedia("(min-width: 1024px)"),h=c=>{s(c.matches)};return h(d),typeof d.addEventListener=="function"?(d.addEventListener("change",h),()=>d.removeEventListener("change",h)):(d.addListener(h),()=>d.removeListener(h))},[]),i}function ee({item:i,mediaEntry:s,totalSlides:d,activeIndex:h,onCycleComplete:c,autoplayEnabled:b=!0,isActive:x,shouldUseDesktopEager:N,onImageLoad:R,deferImageRender:T=!1}){const u=t.useRef(null),[p,g]=t.useState(!1),m=t.useRef(!1),[S,O]=t.useState(!1),[D,y]=t.useState(E);t.useRef(0);const _=t.useCallback(e=>{const r=Math.max(0,e.scrollHeight-e.clientHeight);if(r<=0)return 0;const n=r/B;return!Number.isFinite(n)||n<=0?q:Math.max(q,n)},[]),w=t.useCallback(e=>{const r=Math.max(0,e.scrollHeight-e.clientHeight);if(r<=0)return E;const n=_(e);if(n<=0)return E;const L=Math.round(r/n*1e3);return!Number.isFinite(L)||L<=0?E:Math.max(E,L)},[_]),j=Y({ref:u,active:b&&S,speed:_,loop:!1,startDelay:U,resumeDelay:600,resumeOnUserInput:!0,threshold:.05,resetOnInactive:!1});t.useEffect(()=>{b&&(j.resetPosition(0),u.current?.scrollTo({top:0,left:0,behavior:"auto"}))},[b,j.resetPosition]),t.useEffect(()=>{if(T){g(!1);return}const e=u.current;if(!e)return;const r=e.querySelector("picture img")??e.querySelector("img");if(!r){g(!1);return}if(r.complete&&r.naturalHeight>0){g(!0);return}g(!1);const n=()=>g(!0);return r.addEventListener("load",n,{once:!0}),r.addEventListener("error",n,{once:!0}),()=>{r.removeEventListener("load",n),r.removeEventListener("error",n)}},[i,s,T]),t.useEffect(()=>{p&&R&&!m.current&&(m.current=!0,R())},[p,R]),t.useEffect(()=>{if(!p){O(!1);return}const e=u.current;if(!e)return;let r=!1,n=null;const L=()=>Math.max(0,e.scrollHeight-e.clientHeight)>G,v=()=>{r||(r=!0,n?.(),n=null,O(!0))},F=()=>{if(typeof ResizeObserver>"u"){v();return}let f=null,I=e.scrollHeight;const P=()=>{f||(f=window.setTimeout(()=>{f=null,v()},V))},W=()=>{f&&(window.clearTimeout(f),f=null)},z=new ResizeObserver(()=>{const H=e.scrollHeight;Math.abs(H-I)>X&&(I=H,W()),P()});z.observe(e),P(),n=()=>{z.disconnect(),f&&(window.clearTimeout(f),f=null)}};if(L())F();else if(typeof ResizeObserver<"u"){const f=new ResizeObserver(()=>{L()&&(f.disconnect(),F())});f.observe(e),n=()=>f.disconnect()}else v();const $=window.setTimeout(()=>{v()},J);return()=>{n?.(),window.clearTimeout($)}},[p]),t.useEffect(()=>{if(!S||!b){y(E);return}const e=u.current;if(!e)return;const r=()=>y(w(e));r();const n=typeof ResizeObserver<"u"?new ResizeObserver(()=>r()):null;return n?.observe(e),()=>n?.disconnect()},[S,w]),t.useEffect(()=>{if(!S||!b||d<=1||j.paused)return;const e=U+D+K,r=window.setTimeout(()=>c(),e);return()=>window.clearTimeout(r)},[b,S,c,D,d,j.paused]),t.useEffect(()=>{},[S,x]);const M=C(i.featuredImage)||C(i.bannerImage)||C(i.image)||"",A=!!(s?.desktopEager&&N),k=A?"eager":s?.loading??"lazy",l=A?"high":s?.fetchPriority??"auto",a=()=>T?o.jsx("div",{className:"flex h-full w-full items-center justify-center bg-black/40"}):s?.sources?.length?o.jsxs("picture",{children:[s.sources.map((e,r)=>o.jsx("source",{srcSet:e.srcSet,sizes:e.sizes??s.sizes,type:e.type},`${i.slug??i.id??r}-source-${r}`)),o.jsx("img",{src:s.src,srcSet:s.srcSet,sizes:s.sizes,alt:s.alt||i.alt||i.title||"Project preview",width:s.width,height:s.height,loading:k,decoding:s.decoding??"async",fetchPriority:l,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"})]}):s?.src?o.jsx("img",{src:s.src,srcSet:s.srcSet,sizes:s.sizes,alt:s.alt||i.alt||i.title||"Project preview",width:s.width,height:s.height,loading:k,decoding:s.decoding??"async",fetchPriority:l,draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top"}):M?o.jsx("img",{src:M,alt:i.alt||i.title||"Project preview",loading:A?"eager":"lazy",draggable:!1,className:"block h-auto min-h-full w-full select-none object-cover object-top",decoding:"async",fetchPriority:A?"high":"auto"}):o.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-b from-bg2 via-bg to-bg/80 text-white/30",children:"Preview coming soon"});return o.jsx("div",{className:"relative h-full w-full",children:o.jsxs("div",{className:"relative h-full bg-bg3",children:[o.jsx("div",{className:"flex flex-col gap-3 border-b border-white/10 px-4 py-3 text-white/70 sm:flex-row sm:items-center sm:justify-between",children:o.jsx("div",{className:"flex items-center gap-3 text-xs uppercase tracking-[0.35em] text-white/50",children:o.jsxs("span",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),o.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"}),o.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-800"})]})})}),o.jsx("figure",{ref:u,className:"relative h-full overflow-y-auto overscroll-contain bg-black/40",style:{WebkitOverflowScrolling:"touch"},children:a()}),!1]})})}function le({items:i=[],className:s="",mediaEntries:d=[],staticContainerId:h}){const c=t.useMemo(()=>Array.isArray(i)?i:[],[i]),b=t.useMemo(()=>Array.isArray(d)?d:[],[d]),[x,N]=t.useState(0),[R,T]=t.useState(null),[u,p]=t.useState("idle"),g=t.useRef(null),m=t.useRef(null),S=Z(),[O,D]=t.useState(!1),y=t.useRef(!1),[_,w]=t.useState(!1);t.useEffect(()=>{if(!h){w(!0);return}const l=document.getElementById(h);if(!l){w(!0);return}const a=l.querySelector("img");if(!a){w(!0);return}if(a.complete&&a.naturalHeight>0){const n=requestAnimationFrame(()=>{w(!0)});return()=>cancelAnimationFrame(n)}const e=()=>{requestAnimationFrame(()=>{w(!0)})};a.addEventListener("load",e,{once:!0}),a.addEventListener("error",e,{once:!0});const r=setTimeout(()=>{w(!0)},3e3);return()=>{a.removeEventListener("load",e),a.removeEventListener("error",e),clearTimeout(r)}},[h]);const j=t.useCallback(()=>{if(y.current)return;y.current=!0;const l=h?document.getElementById(h):null;requestAnimationFrame(()=>{requestAnimationFrame(()=>{l&&(l.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>{l.style.display="none"},500)),D(!0)})})},[h]);t.useEffect(()=>{if(!c.length){N(0),T(null),p("idle");return}N(l=>l>=c.length?0:l)},[c.length]),t.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=null),m.current&&(cancelAnimationFrame(m.current),m.current=null)},[]);const M=t.useCallback(l=>{typeof window>"u"||(T(x),N(l),p("pre"),m.current&&(cancelAnimationFrame(m.current),m.current=null),m.current=requestAnimationFrame(()=>{m.current=requestAnimationFrame(()=>{p("animating")})}),g.current&&(window.clearTimeout(g.current),g.current=null),g.current=window.setTimeout(()=>{p("idle"),T(null)},Q))},[x]),A=t.useCallback(()=>{if(!c.length||c.length<=1||u!=="idle")return;const l=(x+1)%c.length;M(l)},[x,c.length,M,u]);if(!c.length)return null;const k="absolute inset-0 transition-transform transition-opacity duration-[750ms] ease-[cubic-bezier(0.4,0,0.2,1)]";return o.jsx("div",{className:`relative h-full ${s}`.trim(),children:o.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:c.map((l,a)=>{const e=a===x,r=a===R,n=e||r&&u!=="idle";if(!(e||r&&u!=="idle"))return null;let v="translate-x-full";return r&&u!=="idle"?v="-translate-x-full":e&&(u==="idle"||R===null?v="translate-x-0":u==="pre"?v="translate-x-full":v="translate-x-0"),o.jsx("div",{className:`${k} shadow-2xl ${v} ${n?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":e?"false":"true",children:o.jsx(ee,{item:l,mediaEntry:b[a],totalSlides:c.length||1,activeIndex:a,onCycleComplete:A,autoplayEnabled:e&&u==="idle"&&O,isActive:e,shouldUseDesktopEager:S,onImageLoad:a===0?j:void 0,deferImageRender:a===0&&!_})},l.slug??l.id??a)})})})}export{le as default};
