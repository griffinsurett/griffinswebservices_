import{r as o,j as i}from"./react-core.QUkC7_l_.js";import{u as ne}from"./useEngagementAutoScroll.8K-EtYKb.js";import{g as q}from"./layoutHelpers.DmHfmlAk.js";import{u as se,a as oe,L as ae,R as ie}from"./useSideDragNavigation.HKnJe7-d.js";import{a as le}from"./animationProps.HaIMKbsm.js";import"./useVisibility.B-3m_lqm.js";import"./IntersectionObserver.CmZxnn85.js";import"./useEngagementAutoplay.L-4y69yR.js";const G=1500,te=30,v=te*1e3,ce=v*4,ee=18,ue=60,fe=3e3,de=6,ge=260,me=18;function he({item:l,i:R,activeIndex:U,itemsLength:A,centerW:Y,centerH:I,sideW:T,sideH:C,tx:L,onSelect:$,mediaChild:g}){const f=o.useRef(null),c=R-U,[w,u]=o.useState(!1),[D,m]=o.useState(!1),[z,H]=o.useState(v),x=o.useMemo(()=>c===0?"center":c===-1||c===A-1?"left":c===1||c===-(A-1)?"right":"hidden",[c,A]),s=x==="center",S=s?"translate(-50%, 0)":"translate(-50%, -50%)",y=o.useCallback(e=>{const r=Math.max(0,e.scrollHeight-e.clientHeight);if(r<=0)return 0;const n=r/te;return!Number.isFinite(n)||n<=0?ee:Math.min(ue,Math.max(ee,n))},[]),W=o.useCallback(e=>{const r=Math.max(0,e.scrollHeight-e.clientHeight);if(r<=0)return v;const n=y(e);if(n<=0)return v;const d=Math.round(r/n*1e3);return!Number.isFinite(d)||d<=0?v:Math.min(ce,Math.max(v,d))},[y]);ne({ref:f,active:s&&w,speed:y,loop:!1,startDelay:G,resumeDelay:900,resumeOnUserInput:!0,threshold:.1,resetOnInactive:!0});const[E,P]=o.useState(0);o.useEffect(()=>{if(!s)return;let e=null;const r=()=>{const n=f.current;if(n){const d=Math.max(0,n.scrollHeight-n.clientHeight),t=d>0?n.scrollTop/d*100:0;P(Math.round(t))}e=requestAnimationFrame(r)};return e=requestAnimationFrame(r),()=>{e&&cancelAnimationFrame(e)}},[s]),o.useEffect(()=>{if(!s||!D){u(!1),H(v);return}const e=f.current;if(!e)return;let r=!1,n=null;const d=()=>Math.max(0,e.scrollHeight-e.clientHeight)>de,t=()=>{r||(r=!0,n?.(),n=null,u(!0))},a=()=>{if(typeof ResizeObserver>"u"){t();return}let h=null,V=e.scrollHeight;const J=()=>{h||(h=window.setTimeout(()=>{h=null,t()},ge))},re=()=>{h&&(window.clearTimeout(h),h=null)},K=new ResizeObserver(()=>{const Q=e.scrollHeight;Math.abs(Q-V)>me&&(V=Q,re()),J()});K.observe(e),J(),n=()=>{K.disconnect(),h&&(window.clearTimeout(h),h=null)}};let p=null;d()?a():typeof ResizeObserver<"u"?(p=new ResizeObserver(()=>{d()&&(p?.disconnect(),p=null,a())}),p.observe(e)):t();const b=window.setTimeout(()=>{t()},fe);return()=>{p?.disconnect(),n?.(),b&&window.clearTimeout(b)}},[s,D]),o.useEffect(()=>{if(!s||!w){H(v);return}const e=f.current;if(!e)return;const r=()=>{H(W(e))};r();const n=typeof ResizeObserver<"u"?new ResizeObserver(()=>r()):null;return n?.observe(e),()=>n?.disconnect()},[s,w,W]),o.useEffect(()=>{if(!s||!w||typeof window>"u")return;const e=f.current;if(!e)return;const r=t=>{e.dispatchEvent(new CustomEvent("autoscroll-user",{bubbles:!0,detail:{phase:t}}))},n=window.setTimeout(()=>{r("start")},G),d=window.setTimeout(()=>{r("end")},G+z);return()=>{window.clearTimeout(n),window.clearTimeout(d),r("end")}},[s,w,z]);const F="absolute left-1/2 overflow-hidden shadow-[0_25px_50px_-12px_rgba(0,0,0,0.5)] transition-all duration-700 ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform bg-gray-900";let j={width:`${T}px`,height:`${C}px`,transform:`${S} scale(0)`,zIndex:10,opacity:0,pointerEvents:"none"};s?j={width:`${Y}px`,height:`${I}px`,transform:`${S} scale(1) rotateY(0deg)`,zIndex:30,opacity:1}:x==="left"?j={width:`${T}px`,height:`${C}px`,transform:`${S} translateX(-${L}px) scale(0.9) rotateY(22deg)`,zIndex:20,opacity:.5,filter:"brightness(0.75)"}:x==="right"&&(j={width:`${T}px`,height:`${C}px`,transform:`${S} translateX(${L}px) scale(0.9) rotateY(-22deg)`,zIndex:20,opacity:.5,filter:"brightness(0.75)"});const B="w-full h-full bg-gray-900 overflow-y-auto overscroll-auto touch-pan-y m-0 p-0 relative",X="w-full h-full bg-gray-900 overflow-hidden pointer-events-none select-none m-0 p-0 relative",_=s?{WebkitOverflowScrolling:"touch",overscrollBehaviorY:"auto"}:void 0,M=()=>{const e=q(l.featuredImage)||q(l.bannerImage)||q(l.image)||"";if(l.imageSources){if(s&&l.imageSources.center)return l.imageSources.center;if((x==="left"||x==="right")&&l.imageSources.side)return l.imageSources.side;if(l.imageSources.mobile)return l.imageSources.mobile}return e},Z=()=>l.dimensions?.aspectRatio&&I>0?{objectFit:"cover",objectPosition:"center top"}:{objectFit:"cover",objectPosition:"center top"},N=M(),k=l.alt||l.title||"Project preview",O=o.useMemo(()=>{if(!g)return;if(!o.isValidElement(g))return g;if(!g.props?.["data-portfolio-placeholder"])return g},[g]);return o.useEffect(()=>{if(!s){m(!1);return}const e=f.current;if(!e)return;const r=e.querySelector("picture img")??e.querySelector("img");if(!r){m(!0);return}const n=()=>m(!0);if(r.complete&&r.naturalHeight>0){m(!0);return}return m(!1),r.addEventListener("load",n,{once:!1}),r.addEventListener("error",n,{once:!1}),()=>{r.removeEventListener("load",n),r.removeEventListener("error",n)}},[s,O,N]),i.jsxs("div",{className:`${F} ${s?"top-0":"top-1/2"}`,style:j,"data-carousel-item":!0,"data-index":R,"data-active":s?"true":"false",onClick:()=>{s||$(R)},children:[i.jsx("figure",{ref:f,className:s?B:X,style:_,"aria-hidden":s?"false":"true",tabIndex:s?0:-1,children:O||(N?i.jsx("img",{src:N,alt:k,loading:R===0?"eager":"lazy",draggable:!1,className:"block w-full h-auto min-h-full select-none",style:Z(),decoding:"async"}):i.jsx("div",{className:"flex h-full w-full bg-gradient-to-b from-bg2 via-bg to-bg/80"}))}),!1]})}function Te({items:l=[],defaultIndex:R=0,autoplay:U=!0,autoAdvanceDelay:A=5e3,showArrows:Y=!0,showDots:I=!0,drag:T=!1,className:C="",children:L}){const $=o.useRef(null),[g,f]=o.useState(R),[c,w]=o.useState(0),u=o.useMemo(()=>Array.isArray(l)?l:[],[l]),D=o.useMemo(()=>o.Children.toArray(L??[]),[L]),m=c>0;o.useLayoutEffect(()=>{if(typeof window>"u")return;const t=$.current;if(!t)return;const a=()=>{const b=t.getBoundingClientRect().width;b&&b!==c&&w(b)};a();const p=new ResizeObserver(a);return p.observe(t),window.addEventListener("resize",a,{passive:!0}),()=>{p.disconnect(),window.removeEventListener("resize",a)}},[c]);const{scopeId:z}=se({containerRef:$,totalItems:u.length,currentIndex:g,setIndex:f,autoplay:U,autoplayTime:A}),H=()=>{const t=c;return t<640?{centerW:280,centerH:190,sideW:180,sideH:120}:t<768?{centerW:340,centerH:230,sideW:220,sideH:150}:t<1024?{centerW:460,centerH:310,sideW:290,sideH:190}:t<1280?{centerW:680,centerH:450,sideW:420,sideH:290}:{centerW:860,centerH:540,sideW:520,sideH:360}},x=t=>{const a=c,b=-(a>=1536?72:a>=1280?56:a>=1024?40:20);return a/2-t/2-b},{centerW:s,centerH:S,sideW:y,sideH:W}=m?H():{centerW:0,centerH:0,sideW:0,sideH:0},E=m?x(y):0,P=()=>f(t=>t===0?u.length-1:t-1),F=()=>f(t=>t===u.length-1?0:t+1),B=(c>=768?48:40)/2,X=c>=1024?20:16,_=c>=1280,M=s/2+B+X,Z=_?`calc(50% - ${E}px)`:`calc(50% - ${M}px)`,N=_?`calc(50% + ${E}px)`:`calc(50% + ${M}px)`,k=o.useRef(null),O=o.useRef(null);oe({enabled:m&&T&&u.length>1,leftElRef:k,rightElRef:O,onLeft:P,onRight:F,dragThreshold:Math.max(40,Math.round(c*.05)),tapThreshold:12});const e=Math.max(140,Math.min(y,520)),r=t=>({left:`calc(50% ${t>=0?"+":"-"} ${Math.abs(t)}px)`,transform:"translateX(-50%)",width:`${e}px`,top:0,height:"100%"}),n=_?E:M,d=_?E:M;return u.length?i.jsx("div",{ref:$,...le("fade-in",{once:!0}),"data-carousel-container":!0,"data-autoplay-scope":z,suppressHydrationWarning:!0,className:`w-full ${C}`.trim(),children:m&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative overflow-visible w-full leading-none",style:{height:`${S}px`},children:[u.map((t,a)=>i.jsx(he,{item:t,i:a,activeIndex:g,itemsLength:u.length,centerW:s,centerH:S,sideW:y,sideH:W,tx:E,onSelect:f,mediaChild:D[a]},t.slug??t.id??a)),T&&u.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("div",{ref:k,className:"absolute z-30 cursor-grab touch-pan-x select-none",style:r(-n),"aria-hidden":"true","data-drag-zone":"left"}),i.jsx("div",{ref:O,className:"absolute z-30 cursor-grab touch-pan-x select-none",style:r(d),"aria-hidden":"true","data-drag-zone":"right"})]}),Y&&u.length>1&&i.jsxs(i.Fragment,{children:[i.jsx(ae,{onClick:P,variant:"floating",position:{left:Z,top:"50%",transform:"translate(-50%, -50%)"}}),i.jsx(ie,{onClick:F,variant:"floating",position:{left:N,top:"50%",transform:"translate(-50%, -50%)"}})]})]}),I&&u.length>1&&i.jsx("nav",{className:"mt-6 flex justify-center gap-3","aria-label":"Carousel Pagination",children:u.map((t,a)=>i.jsx("button",{type:"button",onClick:()=>f(a),className:`w-3 h-3 rounded-full transition-all duration-300 ${a===g?"bg-primary scale-[1.30]":"faded-bg"}`,"aria-label":`Go to slide ${a+1}`},a))})]})}):null}export{Te as default};
