---
// src/layouts/collections/CollectionIndexLayout.astro
/**
 * Default Collection Index Layout
 *
 * The default layout for collection index pages (e.g., /blog, /services).
 *
 * Behavior:
 * - Always shows SecondaryHero with title and description
 * - Uses featuredImage from _meta.mdx if provided, otherwise default
 * - If MDX Content exists → Renders it
 * - If no MDX Content → Renders default grid
 */
import type { CollectionKey } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import ContentRenderer from "@/components/ContentRenderer/ContentRenderer.astro";
import SecondaryHero from "@/layouts/SecondaryHero.astro";
import { query, sortByDate } from "@/utils/query";
import DoubleCard from "../DoubleCard.astro";

export interface Props {
  Content?: any;
  collectionName: CollectionKey;
  collectionMeta: any;
  seoProps: any;
  hasContent?: boolean;
  [key: string]: any;
}

const {
  Content,
  collectionName = "blog",
  collectionMeta = {},
  seoProps = {},
  hasContent = false,
} = Astro.props;

// Get title/description from seoProps or fall back to collectionMeta
const pageTitle = seoProps?.title || collectionMeta?.title || "Blog";
const pageDescription = seoProps?.description || collectionMeta?.description || "";

// Use featuredImage from _meta.mdx if provided, otherwise undefined (will use default)
const heroImage = collectionMeta?.featuredImage;
---

<BaseLayout {...seoProps}>
    {/* Header - SecondaryHero with title and description */}
    <SecondaryHero
      title={pageTitle}
      description={pageDescription}
      image={heroImage}
    />

    {/* Content - Either custom MDX or default grid */}
    <div>
      {
        hasContent && Content ? (
          /* Custom MDX content from _meta.mdx body */
          <Content />
        ) : (
          /* Default: Grid of blog posts sorted by most recent */
          <ContentRenderer
            query={query(collectionName).orderBy(sortByDate("publishDate", "desc"))}
            variant="BlogVariant"
            columns={2}
            title="Latest Articles"
            heading={{
              before: "Stay informed.",
              text: "Read our latest insights.",
            }}
          />
        )
      }
    </div>

     <DoubleCard />
</BaseLayout>
