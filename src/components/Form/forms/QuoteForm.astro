---
// src/components/Form/forms/QuoteForm.astro
/**
 * Quote Form - Compact version for hero sections
 * Simplified form with essential fields: name, email, phone, message
 */
import FormWrapper from "@/components/Form/FormWrapper";
import Input from "@/components/Form/inputs/Input";
import Textarea from "@/components/Form/inputs/Textarea";
import { submitToFormspree } from "@/utils/formspree";

interface Props {
  className?: string;
  buttonText?: string;
}

const {
  className = "",
  buttonText = "Get Your Quote"
} = Astro.props;

// Get current page URL from Astro SSR context
const currentPageUrl = Astro.url.href;

const FORMSPREE_BASE_ACTION = "https://formspree.io/f/";
const quoteFormId = import.meta.env.PUBLIC_FORMSPREE_QUOTE_ID;
const quoteFormAction = quoteFormId
  ? `${FORMSPREE_BASE_ACTION}${quoteFormId}`
  : undefined;

const handleSubmit = async (values: Record<string, unknown>) => {
  if (!quoteFormAction) {
    throw new Error("Quote form is temporarily unavailable. Please try again later.");
  }

  await submitToFormspree({
    endpoint: quoteFormAction,
    values,
    formName: "Quote Request",
    excludeKeys: ["terms-agreement"],
  });
};
---

<div class={className}>
  <FormWrapper
    client:idle
    onSubmit={handleSubmit}
    formAction={quoteFormAction}
    formMethod="post"
    className="group flex flex-col relative overflow-hidden"
    submitButton={{
      text: buttonText,
      className: "w-full",
      disabled: !quoteFormAction
    }}
  >
    <input type="hidden" name="pageUrl" value={currentPageUrl} />
    <div class="relative z-10 space-y-4">
      <div class="grid gap-3 md:grid-cols-2">
        <Input
          client:idle
          name="firstName"
          label="First Name"
          type="text"
          required={true}
          minLength={2}
          placeholder="First Name *"
          containerClassName="md:col-span-1"
          showLabel={false}
        />

        <Input
          client:idle
          name="lastName"
          label="Last Name"
          type="text"
          required={true}
          minLength={2}
          placeholder="Last Name *"
          showLabel={false}
        />

        <Input
          client:idle
          name="email"
          label="Email"
          type="email"
          required={true}
          placeholder="Email Address *"
          showLabel={false}
        />

        <Input
          client:idle
          name="phone"
          label="Phone"
          type="tel"
          placeholder="Phone Number"
          showLabel={false}
        />

        <Textarea
          client:idle
          name="message"
          label="Message"
          required={true}
          minLength={10}
          placeholder="Tell us about your project *"
          rows={3}
          containerClassName="md:col-span-2"
          showLabel={false}
        />
      </div>
    </div>
  </FormWrapper>
</div>
