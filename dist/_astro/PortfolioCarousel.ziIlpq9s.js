import{r as o,j as i}from"./react-core.BKcrIQ47.js";import{u as ne}from"./useEngagementAutoScroll.Dewbw4xG.js";import{g as X}from"./layoutHelpers.DmHfmlAk.js";import{u as se,L as oe,R as ae}from"./useCarouselAutoplay.GGzQQmzF.js";import{b as ie}from"./useVisibility.Dfexy_Di.js";import{u as le}from"./useViewAnimation.-cJ3kFoN.js";import"./useEngagementAutoplay.Bbo495Lu.js";const Z=1500,te=30,b=te*1e3,ce=b*4,ee=18,ue=60,fe=3e3,de=6,ge=260,me=18;function he({item:l,i:R,activeIndex:F,itemsLength:$,centerW:k,centerH:z,sideW:T,sideH:H,tx:j,onSelect:E,mediaChild:m}){const d=o.useRef(null),c=R-F,[v,f]=o.useState(!1),[D,h]=o.useState(!1),[W,N]=o.useState(b),x=o.useMemo(()=>c===0?"center":c===-1||c===$-1?"left":c===1||c===-($-1)?"right":"hidden",[c,$]),a=x==="center",w=a?"translate(-50%, 0)":"translate(-50%, -50%)",_=o.useCallback(e=>{const r=Math.max(0,e.scrollHeight-e.clientHeight);if(r<=0)return 0;const t=r/te;return!Number.isFinite(t)||t<=0?ee:Math.min(ue,Math.max(ee,t))},[]),M=o.useCallback(e=>{const r=Math.max(0,e.scrollHeight-e.clientHeight);if(r<=0)return b;const t=_(e);if(t<=0)return b;const g=Math.round(r/t*1e3);return!Number.isFinite(g)||g<=0?b:Math.min(ce,Math.max(b,g))},[_]);ne({ref:d,active:a&&v,speed:_,loop:!1,startDelay:Z,resumeDelay:900,resumeOnUserInput:!0,threshold:.1,resetOnInactive:!0});const[q,S]=o.useState(0);o.useEffect(()=>{if(!a)return;let e=null;const r=()=>{const t=d.current;if(t){const g=Math.max(0,t.scrollHeight-t.clientHeight),p=g>0?t.scrollTop/g*100:0;S(Math.round(p))}e=requestAnimationFrame(r)};return e=requestAnimationFrame(r),()=>{e&&cancelAnimationFrame(e)}},[a]),o.useEffect(()=>{if(!a||!D){f(!1),N(b);return}const e=d.current;if(!e)return;let r=!1,t=null;const g=()=>Math.max(0,e.scrollHeight-e.clientHeight)>de,p=()=>{r||(r=!0,t?.(),t=null,f(!0))},n=()=>{if(typeof ResizeObserver>"u"){p();return}let u=null,V=e.scrollHeight;const J=()=>{u||(u=window.setTimeout(()=>{u=null,p()},ge))},re=()=>{u&&(window.clearTimeout(u),u=null)},K=new ResizeObserver(()=>{const Q=e.scrollHeight;Math.abs(Q-V)>me&&(V=Q,re()),J()});K.observe(e),J(),t=()=>{K.disconnect(),u&&(window.clearTimeout(u),u=null)}};let s=null;g()?n():typeof ResizeObserver<"u"?(s=new ResizeObserver(()=>{g()&&(s?.disconnect(),s=null,n())}),s.observe(e)):p();const L=window.setTimeout(()=>{p()},fe);return()=>{s?.disconnect(),t?.(),L&&window.clearTimeout(L)}},[a,D]),o.useEffect(()=>{if(!a||!v){N(b);return}const e=d.current;if(!e)return;const r=()=>{N(M(e))};r();const t=typeof ResizeObserver<"u"?new ResizeObserver(()=>r()):null;return t?.observe(e),()=>t?.disconnect()},[a,v,M]),o.useEffect(()=>{if(!a||!v||typeof window>"u")return;const e=d.current;if(!e)return;const r=p=>{e.dispatchEvent(new CustomEvent("autoscroll-user",{bubbles:!0,detail:{phase:p}}))},t=window.setTimeout(()=>{r("start")},Z),g=window.setTimeout(()=>{r("end")},Z+W);return()=>{window.clearTimeout(t),window.clearTimeout(g),r("end")}},[a,v,W]);const P="absolute left-1/2 overflow-hidden shadow-[0_25px_50px_-12px_rgba(0,0,0,0.5)] transition-all duration-700 ease-[cubic-bezier(0.4,0,0.2,1)] will-change-transform bg-gray-900";let y={width:`${T}px`,height:`${H}px`,transform:`${w} scale(0)`,zIndex:10,opacity:0,pointerEvents:"none"};a?y={width:`${k}px`,height:`${z}px`,transform:`${w} scale(1) rotateY(0deg)`,zIndex:30,opacity:1}:x==="left"?y={width:`${T}px`,height:`${H}px`,transform:`${w} translateX(-${j}px) scale(0.9) rotateY(22deg)`,zIndex:20,opacity:.5,filter:"brightness(0.75)"}:x==="right"&&(y={width:`${T}px`,height:`${H}px`,transform:`${w} translateX(${j}px) scale(0.9) rotateY(-22deg)`,zIndex:20,opacity:.5,filter:"brightness(0.75)"});const G="w-full h-full bg-gray-900 overflow-y-auto overscroll-auto touch-pan-y m-0 p-0 relative",U="w-full h-full bg-gray-900 overflow-hidden pointer-events-none select-none m-0 p-0 relative",Y=a?{WebkitOverflowScrolling:"touch",overscrollBehaviorY:"auto"}:void 0,A=()=>{const e=X(l.featuredImage)||X(l.bannerImage)||X(l.image)||"";if(l.imageSources){if(a&&l.imageSources.center)return l.imageSources.center;if((x==="left"||x==="right")&&l.imageSources.side)return l.imageSources.side;if(l.imageSources.mobile)return l.imageSources.mobile}return e},O=()=>l.dimensions?.aspectRatio&&z>0?{objectFit:"cover",objectPosition:"center top"}:{objectFit:"cover",objectPosition:"center top"},I=A(),B=l.alt||l.title||"Project preview",C=o.useMemo(()=>{if(!m)return;if(!o.isValidElement(m))return m;if(!m.props?.["data-portfolio-placeholder"])return m},[m]);return o.useEffect(()=>{if(!a){h(!1);return}const e=d.current;if(!e)return;const r=e.querySelector("picture img")??e.querySelector("img");if(!r){h(!0);return}const t=()=>h(!0);if(r.complete&&r.naturalHeight>0){h(!0);return}return h(!1),r.addEventListener("load",t,{once:!1}),r.addEventListener("error",t,{once:!1}),()=>{r.removeEventListener("load",t),r.removeEventListener("error",t)}},[a,C,I]),i.jsxs("div",{className:`${P} ${a?"top-0":"top-1/2"}`,style:y,"data-carousel-item":!0,"data-index":R,"data-active":a?"true":"false",onClick:()=>{a||E(R)},children:[i.jsx("figure",{ref:d,className:a?G:U,style:Y,"aria-hidden":a?"false":"true",tabIndex:a?0:-1,children:C||(I?i.jsx("img",{src:I,alt:B,loading:R===0?"eager":"lazy",draggable:!1,className:"block w-full h-auto min-h-full select-none",style:O(),decoding:"async"}):i.jsx("div",{className:"flex h-full w-full bg-gradient-to-b from-bg2 via-bg to-bg/80"}))}),!1]})}function Re({items:l=[],defaultIndex:R=0,autoplay:F=!0,autoAdvanceDelay:$=5e3,showArrows:k=!0,showDots:z=!0,drag:T=!1,className:H="",children:j}){const E=o.useRef(null),[m,d]=o.useState(R),[c,v]=o.useState(0),f=o.useMemo(()=>Array.isArray(l)?l:[],[l]),D=o.useMemo(()=>o.Children.toArray(j??[]),[j]),h=c>0;o.useLayoutEffect(()=>{if(typeof window>"u")return;const n=E.current;if(!n)return;const s=()=>{const u=n.getBoundingClientRect().width;u&&u!==c&&v(u)};s();const L=new ResizeObserver(s);return L.observe(n),window.addEventListener("resize",s,{passive:!0}),()=>{L.disconnect(),window.removeEventListener("resize",s)}},[c]);const W=le({ref:E,duration:500,delay:0,easing:"cubic-bezier(0.4, 0, 0.2, 1)",threshold:.1,rootMargin:"0px 0px -20% 0px"}),{scopeId:N}=se({containerRef:E,totalItems:f.length,currentIndex:m,setIndex:d,autoplay:F,autoplayTime:$}),x=()=>{const n=c;return n<640?{centerW:280,centerH:190,sideW:180,sideH:120}:n<768?{centerW:340,centerH:230,sideW:220,sideH:150}:n<1024?{centerW:460,centerH:310,sideW:290,sideH:190}:n<1280?{centerW:680,centerH:450,sideW:420,sideH:290}:{centerW:860,centerH:540,sideW:520,sideH:360}},a=n=>{const s=c,u=-(s>=1536?72:s>=1280?56:s>=1024?40:20);return s/2-n/2-u},{centerW:w,centerH:_,sideW:M,sideH:q}=h?x():{centerW:0,centerH:0,sideW:0,sideH:0},S=h?a(M):0,P=()=>d(n=>n===0?f.length-1:n-1),y=()=>d(n=>n===f.length-1?0:n+1),U=(c>=768?48:40)/2,Y=c>=1024?20:16,A=c>=1280,O=w/2+U+Y,I=A?`calc(50% - ${S}px)`:`calc(50% - ${O}px)`,B=A?`calc(50% + ${S}px)`:`calc(50% + ${O}px)`,C=o.useRef(null),e=o.useRef(null);ie({enabled:h&&T&&f.length>1,leftElRef:C,rightElRef:e,onLeft:P,onRight:y,dragThreshold:Math.max(40,Math.round(c*.05)),tapThreshold:12});const r=Math.max(140,Math.min(M,520)),t=n=>({left:`calc(50% ${n>=0?"+":"-"} ${Math.abs(n)}px)`,transform:"translateX(-50%)",width:`${r}px`,top:0,height:"100%"}),g=A?S:O,p=A?S:O;return f.length?i.jsx("div",{ref:E,"data-carousel-container":!0,"data-autoplay-scope":N,suppressHydrationWarning:!0,className:`w-full ${H}`.trim(),...W.props,children:h&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative overflow-visible w-full leading-none",style:{height:`${_}px`},children:[f.map((n,s)=>i.jsx(he,{item:n,i:s,activeIndex:m,itemsLength:f.length,centerW:w,centerH:_,sideW:M,sideH:q,tx:S,onSelect:d,mediaChild:D[s]},n.slug??n.id??s)),T&&f.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("div",{ref:C,className:"absolute z-30 cursor-grab touch-pan-x select-none",style:t(-g),"aria-hidden":"true","data-drag-zone":"left"}),i.jsx("div",{ref:e,className:"absolute z-30 cursor-grab touch-pan-x select-none",style:t(p),"aria-hidden":"true","data-drag-zone":"right"})]}),k&&f.length>1&&i.jsxs(i.Fragment,{children:[i.jsx(oe,{onClick:P,variant:"floating",position:{left:I,top:"50%",transform:"translate(-50%, -50%)"}}),i.jsx(ae,{onClick:y,variant:"floating",position:{left:B,top:"50%",transform:"translate(-50%, -50%)"}})]})]}),z&&f.length>1&&i.jsx("nav",{className:"mt-6 flex justify-center gap-3","aria-label":"Carousel Pagination",children:f.map((n,s)=>i.jsx("button",{type:"button",onClick:()=>d(s),className:`w-3 h-3 rounded-full transition-all duration-300 ${s===m?"bg-primary scale-[1.30]":"faded-bg"}`,"aria-label":`Go to slide ${s+1}`},s))})]})}):null}export{Re as default};
