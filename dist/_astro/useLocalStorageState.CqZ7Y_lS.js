import{r as u}from"./react-core.aUjNHagF.js";function h(o,p,{raw:a=!0,validate:n,syncTabs:i=!0,serialize:l=a?(e=>String(e)):(e=>JSON.stringify(e)),deserialize:c=a?(e=>e):(e=>JSON.parse(e))}={}){const e=u.useRef(p),s=u.useCallback(()=>{const t=e.current;return typeof t=="function"?t():t},[]),d=u.useCallback(()=>{if(typeof window>"u")return s();try{const t=window.localStorage.getItem(o);if(t!=null){const r=c(t);if(!n||n(r))return r}}catch{}return s()},[o,c,n,s]),[f,w]=u.useState(d),g=u.useRef(!1);return u.useEffect(()=>{if(!(typeof window>"u")){if(!g.current){g.current=!0;try{const t=window.localStorage.getItem(o);if(t!=null){const r=c(t);if(!n||n(r)){r!==f&&w(r);return}}}catch{}}try{if(n&&!n(f))return;window.localStorage.setItem(o,l(f))}catch{}}},[o,f,l,n,c]),u.useEffect(()=>{if(!i||typeof window>"u")return;const t=r=>{if(r.storageArea===window.localStorage&&r.key===o)try{if(r.newValue==null)return;const S=c(r.newValue);(!n||n(S))&&w(S)}catch{}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[o,c,n,i]),[f,w]}export{h as u};
