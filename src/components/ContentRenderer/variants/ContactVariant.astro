---
// src/components/ContentRenderer/variants/ContactVariant.astro
/**
 * Contact Variant - Contact information with social media
 * Features: FeatureCard style contact cards, embedded social media section
 *
 * Uses the linkBehavior system for URL/displayValue generation.
 * Items should have: url, displayValue (from prepareEntry), title, icon
 */
import ContentRenderer from "../ContentRenderer.astro";
import type { BaseVariantProps } from "../ContentRenderer.types";
import Section from "@/components/Section.astro";
import FeatureCard from "@/components/LoopComponents/FeatureCard";
import Button from "@/components/Button/Button";
import { query } from "@/utils/query";
import { shouldShowCollectionCTA } from "../utils/helpers";
import ContactForm from "@/components/Form/forms/ContactForm.astro";
import { toArray } from "@/utils/array";

interface Props extends BaseVariantProps {
  columns?: 1 | 2 | 3;
  ctaHref?: string;
  ctaText?: string;
}

const {
  items = [],
  title,
  description,
  className = "",
  columns = 2,
  collectionUrl,
  collectionTitle,
  id,
  showButtonSection = true,
  ctaHref,
  ctaText,
} = Astro.props as Props;

const safeItems = toArray(items);

const columnClasses = {
  1: "grid-cols-1",
  2: "grid-cols-1 md:grid-cols-2",
  3: "grid-cols-1 md:grid-cols-2 lg:grid-cols-3",
};
---

<Section id={id} class={`py-16 w-full ${className}`}>
  <div class="flex flex-col-reverse justify-center gap-4 lg:gap-8 items-start lg:flex-row inner-section">
    <div>
      {safeItems.length > 0 && (
        <ul class={`flex flex-col gap-4 list-none`}>
          {safeItems.map((item: any) => (
            <li
              class="relative overflow-hidden"
              data-animate="fade-in-up"
              data-animate-threshold="0.15"
              data-animate-root-margin="-10% 0px -10% 0px"
            >
              <FeatureCard
                client:visible
                data={{
                  icon: item.icon,
                  title: item.title,
                  description: item.displayValue ?? item.description,
                  url: item.url,
                }}
                ringDuration={800}
                listItemProps={{
                  layout: "horizontal",
                  alignment: "left",
                  className: "gap-1 w-full flex items-start",
                  iconClassName: "icon-large card-icon-color mr-4",
                  iconSize: "xl",
                  titleTag: "h3",
                  titleClassName: "text-heading h3 my-4",
                  descriptionClassName: "text-lg text-text",
                  showDescription: true,
                }}
              />
            </li>
          ))}
        </ul>
      )}

      {showButtonSection &&
        shouldShowCollectionCTA(collectionUrl, safeItems.length) &&
        (ctaText || title || collectionTitle) &&
        (ctaHref || collectionUrl) && (
        <div class="mt-12 text-left">
          <Button
            href={ctaHref ?? collectionUrl}
            rightIcon="lu:arrow-right"
            variant="primary"
            size="lg"
          >
            {ctaText ?? `View All ${(title ?? collectionTitle ?? "").trim()}`}
          </Button>
        </div>
      )}
    </div>
    <div class="flex flex-col justify-between w-full">
      <ContactForm />
    </div>
  </div>
</Section>
